===============================
    Azure Active Directory
===============================
Team1=1137541f-a26e-459d-a084-e55c3acadfcc
Web-dev=8cf89ce4-c6a5-4164-a2a2-d679368c745d
Api-dev=926b8d6d-815c-4fc1-8f1d-cdb4459ad2bd


KEYVAULT:
https://hackteam1kv.vault.azure.net/


SP:
{
  "appId": "7fa3611a-b5ff-4e6c-b625-7a9b58b227b4",
  "displayName": "sp-aks-hack3",
  "name": "http://sp-aks-hack3",
  "password": "I31eH0vUYe.7cx~0WArb7mSEzLjRqazT-5",
  "tenant": "cbddfaac-0fb1-417c-aac3-8d2fa625eb0b"
}

Asignamos permisos al SP:

az role assignment create --role Reader --assignee 7fa3611a-b5ff-4e6c-b625-7a9b58b227b4 --scope /subscriptions/37d34961-9643-4b36-bb4d-d6490a5e747b/resourceGroups/teamResources/providers/Microsoft.KeyVault/vaults/hackteam1kv
{
  "canDelegate": null,
  "condition": null,
  "conditionVersion": null,
  "description": null,
  "id": "/subscriptions/37d34961-9643-4b36-bb4d-d6490a5e747b/resourceGroups/teamResources/providers/Microsoft.KeyVault/vaults/hackteam1kv/providers/Microsoft.Authorization/roleAssignments/8500ef71-83a6-4edc-94e6-50d3207b87fc",       
  "name": "8500ef71-83a6-4edc-94e6-50d3207b87fc",
  "principalId": "b427a4a1-bd8a-49e3-9335-be77624bfdce",
  "principalType": "ServicePrincipal",
  "resourceGroup": "teamResources",
  "roleDefinitionId": "/subscriptions/37d34961-9643-4b36-bb4d-d6490a5e747b/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7",
  "scope": "/subscriptions/37d34961-9643-4b36-bb4d-d6490a5e747b/resourceGroups/teamResources/providers/Microsoft.KeyVault/vaults/hackteam1kv",
  "type": "Microsoft.Authorization/roleAssignments"
}

az keyvault set-policy -n hackteam1kv --key-permissions get --spn 7fa3611a-b5ff-4e6c-b625-7a9b58b227b4
az keyvault set-policy -n hackteam1kv --secret-permissions get --spn 7fa3611a-b5ff-4e6c-b625-7a9b58b227b4
az keyvault set-policy -n hackteam1kv --certificate-permissions get --spn <YOUR SPN CLIENT ID>


CLIENT_ID=7fa3611a-b5ff-4e6c-b625-7a9b58b227b4
az keyvault set-policy -n hackteam1kv --secret-permissions get --spn 7fa3611a-b5ff-4e6c-b625-7a9b58b227b4

NO LO HEMOS PODIDO HACER? FIX DE RBAC
az keyvault set-policy -n hackteam1kv --secret-permissions get --spn 7fa3611a-b5ff-4e6c-b625-7a9b58b227b4




----

Creaci√≥n del secreto K8S - SP:
k create secret generic secrets-store-creds --from-literal clientid=7fa3611a-b5ff-4e6c-b625-7a9b58b227b4 --from-literal clientsecret=I31eH0vUYe.7cx~0WArb7mSEzLjRqazT-5 -n tripapi

k create secret generic kvcreds --from-literal clientid=7fa3611a-b5ff-4e6c-b625-7a9b58b227b4 --from-literal clientsecret=I31eH0vUYe.7cx~0WArb7mSEzLjRqazT-5 --type=azure/kv







kubectl create secret generic kvcreds --from-literal clientid=7fa3611a-b5ff-4e6c-b625-7a9b58b227b4 --from-literal clientsecret=I31eH0vUYe.7cx~0WArb7mSEzLjRqazT-5 --type=azure/kv



kubectl config set-context --current --namespace=tripapi